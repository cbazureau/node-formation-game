<html>
  <head>
    <title>Reversi Game</title>
    <script src="socket.io.js"></script>
    <style>
      body {
        background: #eee;
        font-size: 10px;
      }
      #container {
        display: flex;
        align-items: flex-start;
        justify-content: center;
        margin: 20px 0;
      }
      #log {
        width: 300px;
        height: 478px;
        overflow-y: scroll;
        background: white;
        padding: 5px;
        font-size: 0.9rem;
      }
      #log .success {
        color: green;
      }
      #log .error {
        color: red;
      }
      #gameboard table {
        table-layout: fixed;
        border: 0;
        border-spacing: 1px;
      }
      #gameboard table td {
        width: 60px;
        height: 60px;
        padding: 0;
        margin: 0;
        position: relative;
      }
      .piece {
        display: block;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate3d(-50%, -50%, 0);
      }
      .piece-white {
        background: white;
      }
      .piece-black {
        background: black;
      }

    </style>
    <script>
      function start() {
        document.getElementById('log').innerHTML = "";
        fetch('/start');
      }
      function addAction({ errorName, uri }) {
        const div = document.createElement('div');
        if(errorName === 'OK') {
          div.innerHTML = `${uri}`;
          div.className = 'success';
        } else {
          div.innerHTML = `${uri} - ${errorName}`;
          div.className = 'error';
        }
        document.getElementById('log').appendChild(div);
        document.getElementById('log').scrollTo(0,document.getElementById('log').scrollHeight);
      }
      function reloadTable({ matrix, uri, next }) {
        if(uri) addAction({
          errorName: 'OK',
          uri,
        })
        document.getElementById('gameboard').innerHTML = "";
        const table = document.createElement('table');
        document.getElementById('gameboard').appendChild(table);
        for (var i = 0; i < matrix.length; i++) {
            var tr = document.createElement('tr');
            table.appendChild(tr);
            for (var j = 0; j < matrix[i].length; j++) {
                var tdElement = document.createElement('td');
                tdElement.bgColor = 'green';
                tdElement.setAttribute('url', `./play/${next}/${i}/${j}`)
                tdElement.onclick = function () {
                  fetch(this.getAttribute('url'))
                };
                tr.appendChild(tdElement);
                if(matrix[i][j] === 'green') {
                  tdElement.innerHTML = '&nbsp;';
                } else {
                  var span = document.createElement('span');
                  span.className = `piece piece-${matrix[i][j]}`;
                  tdElement.appendChild(span);
                }

            }
        }
      }
    </script>
  </head>
  <body>
    <button onClick="start()">Start</button>
    <div id="container">
      <div id="gameboard"></div>
      <div id="log"></div>
    </div>
    <script>
      const socket = io('http://localhost:3005')
      socket.on('refresh', reloadTable)
      socket.on('error', addAction)
      socket.emit('change color', 'red')
    </script>
  </body>
</html>
